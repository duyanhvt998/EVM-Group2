<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVM Order List</title>

    <!-- Bootstrap -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/mainPageStyle.css">

    <style>
        .order-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .order-card {
            background-color: #fff;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            padding: 20px;
            transition: transform 0.18s ease, box-shadow 0.18s ease;
        }

        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
        }

        .order-status {
            font-weight: 600;
        }

        .order-actions button {
            border: none;
            border-radius: 8px;
            padding: 8px 14px;
            font-weight: 600;
            color: white;
            margin: 0 6px;
        }

        .btn-approve { background-color: #28a745; }
        .btn-approve:hover { background-color: #218838; }

        .btn-reject { background-color: #dc3545; }
        .btn-reject:hover { background-color: #c82333; }

        .mainContent {
            padding-right: 40px;
            padding-left: 40px;
        }
    </style>
</head>

<body class="bg-gradient2-custom">
<div class="d-flex">
    <!-- NavBar -->
    <div th:replace="~{mainPage/navBarFragment :: navBar}"></div>

    <!-- Main content -->
    <div class="mainContent flex-grow-1 p-4">

        <h2 class="mb-4 fw-bold text-dark">EVM Order List</h2>

        <!-- ðŸ”¹ Hiá»ƒn thá»‹ thÃ´ng bÃ¡o sau khi xá»­ lÃ½ -->
        <div th:if="${message}" class="alert text-center w-75 mx-auto mt-3"
             th:classappend="${statusType == 'Approved'} ? 'alert-success' : 'alert-danger'"
             th:text="${message}">
        </div>

        <script>
            // áº¨n thÃ´ng bÃ¡o sau 3 giÃ¢y
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) alert.style.display = 'none';
            }, 3000);
        </script>

        <!-- ðŸ”¹ Náº¿u khÃ´ng cÃ³ Ä‘Æ¡n hÃ ng -->
        <div th:if="${#lists.isEmpty(orders)}" class="text-center text-muted mt-5">
            <h5>No orders found.</h5>
        </div>

        <!-- ðŸ”¹ Danh sÃ¡ch Ä‘Æ¡n hÃ ng -->
        <div class="order-grid" th:if="${!#lists.isEmpty(orders)}">

            <div th:each="order : ${orders}" class="order-card">
                <p><strong>Order ID:</strong>
                    <span th:text="${order.purchaseOrderId}">-</span></p>

                <p><strong>Dealer ID:</strong>
                    <span th:text="${order.dealerId}">-</span></p>

                <p><strong>Staff ID:</strong>
                    <span th:text="${order.staffId}">-</span></p>

                <p><strong>Status:</strong>
                    <span th:if="${order.status == 'Pending'}"
                          class="order-status text-warning"
                          th:text="${order.status}"></span>
                    <span th:if="${order.status == 'Approved'}"
                          class="order-status text-success"
                          th:text="${order.status}"></span>
                    <span th:if="${order.status == 'Rejected'}"
                          class="order-status text-danger"
                          th:text="${order.status}"></span>
                    <span th:if="${order.status != 'Pending' and order.status != 'Approved' and order.status != 'Rejected'}"
                          class="order-status"
                          th:text="${order.status}">Unknown</span>
                </p>

                <p><strong>Date:</strong>
                    <span th:text="${#dates.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">-</span>
                </p>

                <!-- ðŸ”¹ NÃºt hÃ nh Ä‘á»™ng -->
                <div class="order-actions mt-3 text-center"
                     th:if="${order.status == 'Pending'}">

                    <form th:action="@{'/evm/orders/process/' + ${order.purchaseOrderId}}"
                          method="post" style="display:inline;">
                        <input type="hidden" name="actionType" value="Approve"/>
                        <button type="submit" class="btn-approve">Approve</button>
                    </form>

                    <form th:action="@{'/evm/orders/process/' + ${order.purchaseOrderId}}"
                          method="post" style="display:inline;">
                        <input type="hidden" name="actionType" value="Reject"/>
                        <button type="submit" class="btn-reject">Reject</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
